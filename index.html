<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>JS表达式运算</title>
</head>
<body>
  <h1>请使用Chrome并按F12进行调试和测试</h1>
<script type="text/javascript" src="jquery-3.2.0.min.js"></script>
<script type="text/javascript" src="expression.js"></script>
<script>


  function test(context,expr,result){     
     console.group("测试样例：" + expr);
     console.time("编译和执行");
     var _result = context.calc(expr);     
     console.timeEnd("编译和执行");
     if(result == _result)
        console.log("计算结果%c[%s]：%s=%f","font-size:20px; color:green;","成功",expr,_result);
     else
        console.log("计算结果%c[%s]：%s=%f","font-size:20px; color:red;","失败",expr,_result);
     console.log("语法栈：");
     console.log(context.getFinalTokens());     
     console.assert(result == _result,"测试失败");     
     console.groupEnd();
  }

  $(function () {
     var context = new CalContext();
     context.putData("$1",5);//增加值栈——变量
     context.putData("tan",function(a){return Math.tan(a);});//增加值栈——函数
     context.putData("people",{
        year: 28,
        getRealYear: function(){
          return this.year + 2;
        }
     });//增加值栈——对象


     test(context,"40+8*2",56);

     test(context,"40*8+2",322);

     test(context,"40/8+2",7);

     test(context,"40+8/2",44);

     test(context,"(40+8)/2",24);

     test(context,"40*(8-2)",240);

  });
</script>
</body>
</html>